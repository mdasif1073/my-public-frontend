<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend to Backend</title>
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; }
        .container { border: 1px solid #ccc; padding: 20px; display: inline-block; border-radius: 8px; }
        button { padding: 10px 15px; font-size: 16px; margin: 10px; cursor: pointer; }
        #results, #ping-results { margin-top: 20px; font-size: 18px; color: #333; }
        #latency { font-weight: bold; color: #007BFF; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Frontend-Backend Connection Test</h1>
        
        <!-- Button for the original data fetch -->
        <button onclick="fetchData()">Get Data from Backend</button>
        <div id="results"></div>

        <hr>

        <!-- NEW: Button and display for the latency test -->
        <h2>Latency Test</h2>
        <button onclick="pingBackend()">Ping Backend</button>
        <div id="ping-results">
            <p>Pings sent: <span id="ping-count">0</span></p>
            <p>Last Ping Latency: <span id="latency">N/A</span> ms</p>
        </div>
    </div>

    <script>
        const dataApiUrl = 'https://api.mdasif-code.me/api/data';
        // NEW: URL for our new ping endpoint
        const pingApiUrl = 'https://api.mdasif-code.me/api/ping';

        // Original function to fetch data
        async function fetchData() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent = 'Loading...';
            try {
                const response = await fetch(dataApiUrl);
                const data = await response.json();
                resultsDiv.textContent = data.message;
            } catch (error) {
                console.error('Fetch error:', error);
                resultsDiv.textContent = 'Error: Could not connect to the backend.';
            }
        }

        // NEW: Function to handle the ping test
        async function pingBackend() {
            const latencySpan = document.getElementById('latency');
            const pingCountSpan = document.getElementById('ping-count');

            try {
                // Record the time just before we send the request
                const startTime = performance.now();

                const response = await fetch(pingApiUrl);
                const data = await response.json();
                
                // Record the time just after we receive the response
                const endTime = performance.now();
                
                // Calculate the difference and round it
                const latency = Math.round(endTime - startTime);

                // Update the page with the new data
                latencySpan.textContent = latency;
                pingCountSpan.textContent = data.ping_count;

            } catch (error) {
                console.error('Ping error:', error);
                latencySpan.textContent = 'Error!';
            }
        }
    </script>

</body>
</html>